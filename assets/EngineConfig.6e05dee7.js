var j=Object.defineProperty;var A=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var U=(e,n,c)=>n in e?j(e,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[n]=c,V=(e,n)=>{for(var c in n||(n={}))X.call(n,c)&&U(e,c,n[c]);if(A)for(var c of A(n))Y.call(n,c)&&U(e,c,n[c]);return e};import{D as G}from"./vuedraggable.umd.63866033.js";import{g as N}from"./images.7133086d.js";import{_ as M,d as z,T as H,r as E,I as K,x as Q,a as W,G as Z,o as s,j as u,g as a,t as l,h as r,b as d,i as m,F as L,a0 as x,P as ee,s as S,a3 as oe,f as y,U as w,l as ne,c as q,p as te,q as ae}from"./index.7b0c689e.js";const ie=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u6587\u5B57\u56FE\u6807",value:"text"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],se=z({name:"EngineConfig",components:{Draggable:G,Tips:H},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:n}){const c=E(!1),_=E(!1),g=E([]),F=E([]),k=E(""),h=E(!1),{t:D}=K();Q(()=>{g.value=JSON.parse(JSON.stringify(e.engineList)),F.value=JSON.parse(JSON.stringify(e.backupEngineList))});const C=f=>{const{oldIndex:p}=f,{iconType:i}=g.value[p];i!=="local"&&(_.value=!0)},B=async()=>{await x(),_.value=!1},T=f=>{const{originalEvent:p}=f;let i;if(p.type==="touchend"){const{clientX:v,clientY:b}=p.changedTouches[0];i=document.elementFromPoint(v,b)}else{const{clientX:v,clientY:b}=p;i=document.elementFromPoint(v,b)}if((i==null?void 0:i.className)==="delete-area"&&window.confirm(D("\u662F\u5426\u5220\u9664\u8BE5\u81EA\u5B9A\u4E49\u5F15\u64CE"))){const{newIndex:v}=f;g.value.splice(v,1)}n("update",{engineList:g.value,backupEngineList:F.value})},t=W({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0",trigger:"blur"}],link:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",trigger:"blur"}],iconType:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u6807\u7C7B\u578B",trigger:"change"}],iconPath:[{validator:$,trigger:"blur"}]}});function $(f,p,i){t.formData.iconType==="network"&&!p?i(new Error("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")):i()}const o=E(),I=Z(()=>t.formData.iconType==="api"&&t.formData.link||t.formData.iconType==="network"&&t.formData.iconPath||t.formData.iconType==="text"&&t.formData.name),J=()=>{t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value=!0},P=()=>{o.value.resetFields(),t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value=!1};return{engineDialogVisible:h,dragDisabled:c,showDeleteArea:_,cloneEngineList:g,cloneBackupEngineList:F,handleDragChoose:C,handleDragUnchoose:B,handleDragEnd:T,handleAddNewEngine:J,handleEditEngine:f=>{const{_id:p,name:i,link:v,iconType:b,iconPath:O}=f;b!=="local"&&(t.formData={_id:p,name:i,link:v,iconType:b,iconPath:O},h.value=!0)},iconTypeList:ie,state:t,form:o,showIconPreview:I,close:P,submit:()=>{o.value.validate(async f=>{if(f){if(t.formData.iconType==="api"&&k.value)try{const i=await(await fetch(`${ee}/api/icon?url=${encodeURIComponent(t.formData.link)}&type=link`)).text();i&&(t.formData.iconType="network",t.formData.iconPath=i)}catch{}if(t.formData._id){const p=g.value.findIndex(i=>i._id===t.formData._id);~p&&(g.value[p]=V({},S(t.formData)))}else t.formData._id=oe(),g.value.push(V({},S(t.formData)));n("update",{engineList:g.value,backupEngineList:F.value}),P()}else return!1})},getTargetIcon:N,tempIconLink:k,handleLinkInputBlur:()=>{k.value=N(t.formData.link)}}}}),R=e=>(te("data-v-20649a42"),e=e(),ae(),e),le={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},ue={class:"warning"},re={class:"content"},de={class:"text s-title"},ce={class:"current-engine-wrapper"},pe=["onDblclick","title"],me=["src"],ge=["src"],fe={key:2,class:"no-icon"},he={class:"text"},ye={class:"text s-title"},De={class:"backup-engine-wrapper"},ve={class:"engine-list-item"},Ee=["src"],ke=["src"],be={key:2,class:"no-icon"},Fe={class:"text"},_e={key:0,class:"delete-area"},Te={class:"form-control"},we={class:"tips"},Ce=R(()=>a("b",null,"[0]",-1)),Be={class:"tips"},$e=R(()=>a("b",null,"https://juejin.im/search?query=[0]&type=all",-1)),Ve={class:"icon-img-preview-box"},Le=["src"],Ie=["src"],Pe={key:2,class:"no-icon"},Ae={key:1,class:"icon-img-preview"},Ue={class:"footer",style:{"text-align":"right",padding:"12px"}};function Ne(e,n,c,_,g,F){const k=y("Draggable"),h=y("el-input"),D=y("el-form-item"),C=y("Tips"),B=y("el-radio"),T=y("el-radio-group"),t=y("el-form"),$=y("easy-dialog");return s(),u(L,null,[a("div",le,[a("div",ue,l(e.$t("searchConfigTips")),1),a("div",re,[a("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:n[0]||(n[0]=(...o)=>e.handleAddNewEngine&&e.handleAddNewEngine(...o))},l(e.$t("\u6DFB\u52A0")),1),a("div",de,l(e.$t("\u5F53\u524D\u5F15\u64CE\u7EC4")),1),a("div",ce,[r(k,{modelValue:e.cloneEngineList,"onUpdate:modelValue":n[1]||(n[1]=o=>e.cloneEngineList=o),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",{class:"engine-list-item",onDblclick:I=>e.handleEditEngine(o),title:o.iconType!=="local"?e.$t("\u53CC\u51FB\u91CD\u65B0\u7F16\u8F91"):""},[o.iconType==="local"||o.iconType==="network"?(s(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,me)):m("",!0),o.iconType==="api"?(s(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,ge)):m("",!0),o.iconType==="text"?(s(),u("div",fe,l(o.name.slice(0,1)),1)):m("",!0),a("div",he,l(o.name),1)],40,pe)]),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),a("div",ye,l(e.$t("\u5907\u7528\u5F15\u64CE\u7EC4")),1),a("div",De,[r(k,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":n[2]||(n[2]=o=>e.cloneBackupEngineList=o),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",ve,[o.iconType==="local"||o.iconType==="network"?(s(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,Ee)):m("",!0),o.iconType==="api"?(s(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,ke)):m("",!0),o.iconType==="text"?(s(),u("div",be,l(o.name.slice(0,1)),1)):m("",!0),a("div",Fe,l(o.name),1)])]),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(s(),u("div",_e,l(e.$t("\u62D6\u62FD\u81F3\u6B64\u5904\u5220\u9664")),1)):m("",!0)])])]),r($,{modelValue:e.engineDialogVisible,"onUpdate:modelValue":n[10]||(n[10]=o=>e.engineDialogVisible=o),title:`${e.state.formData._id?e.$t("\u7F16\u8F91"):e.$t("\u6DFB\u52A0")}${e.$t("\u81EA\u5B9A\u4E49\u5F15\u64CE")}`,width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog"},{footer:d(()=>[a("div",Ue,[a("button",{type:"button",class:"btn",onClick:n[8]||(n[8]=(...o)=>e.close&&e.close(...o))},l(e.$t("\u53D6\u6D88")),1),a("button",{type:"button",class:"btn btn-primary",onClick:n[9]||(n[9]=(...o)=>e.submit&&e.submit(...o))},l(e.$t("\u786E\u8BA4")),1)])]),default:d(()=>[r(t,{ref:"form","label-width":"90px",model:e.state.formData,rules:e.state.formRules},{default:d(()=>[r(D,{label:e.$t("\u5F15\u64CE\u540D\u79F0"),prop:"name"},{default:d(()=>[r(h,{modelValue:e.state.formData.name,"onUpdate:modelValue":n[3]||(n[3]=o=>e.state.formData.name=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(D,{label:e.$t("\u5F15\u64CE\u5730\u5740"),prop:"link"},{default:d(()=>[a("div",Te,[r(h,{modelValue:e.state.formData.link,"onUpdate:modelValue":n[4]||(n[4]=o=>e.state.formData.link=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740"),onBlur:e.handleLinkInputBlur},null,8,["modelValue","placeholder","onBlur"]),r(C,null,{default:d(()=>[a("div",we,[w(l(e.$t("engineConfigTips1"))+" ",1),Ce,w(" "+l(e.$t("engineConfigTips2")),1)]),a("div",Be,[w(l(e.$t("\u4F8B\u5982"))+": ",1),$e])]),_:1})])]),_:1},8,["label"]),r(D,{label:e.$t("\u5F15\u64CE\u56FE\u6807"),prop:"iconType"},{default:d(()=>[r(T,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[5]||(n[5]=o=>e.state.formData.iconType=o)},{default:d(()=>[(s(!0),u(L,null,ne(e.iconTypeList,o=>(s(),q(B,{label:o.value,key:o.value},{default:d(()=>[w(l(e.$t(o.label)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.state.formData.iconType==="network"?(s(),q(D,{key:0,label:e.$t("\u56FE\u6807\u5730\u5740"),prop:"iconPath"},{default:d(()=>[r(T,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[7]||(n[7]=o=>e.state.formData.iconType=o)},{default:d(()=>[r(h,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":n[6]||(n[6]=o=>e.state.formData.iconPath=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):m("",!0),r(D,{label:e.$t("\u56FE\u6807\u9884\u89C8")},{default:d(()=>[a("div",Ve,[e.showIconPreview?(s(),u(L,{key:0},[e.state.formData.iconType==="network"?(s(),u("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,Le)):m("",!0),e.state.formData.iconType==="api"?(s(),u("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,Ie)):m("",!0),e.state.formData.iconType==="text"?(s(),u("div",Pe,l(e.state.formData.name.slice(0,1)),1)):m("",!0)],64)):(s(),u("div",Ae))])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}var Ye=M(se,[["render",Ne],["__scopeId","data-v-20649a42"]]);export{Ye as default};
