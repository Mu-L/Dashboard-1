import{_ as R,d as $,u as D,G as K,I as T,a as j,x as N,y as q,r as z,o as c,j as u,g as o,F as J,l as Z,E as g,h as F,b as E,H,m as G,V as P,s as W,f as Q,D as w,t as b,L as _,i as m,N as x,R as X,O as A,p as Y,q as ee}from"./index.87588bc9.js";import{a as B,b as te}from"./images.4ec01e13.js";const S={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const oe=$({name:"Collection",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(e){const d=D(),r=K(()=>e.componentSetting.userSettingKeyMap||{}),C=K(()=>H(e.componentSetting.position)),{t:v}=T(),t=j({editingActive:!1,editingInfo:{key:"",url:"",remark:""}}),k=a=>{if(!e.componentSetting.useKeyboardEvent||!d.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const i=a.keyCode,p=Object.keys(S).find(f=>S[f].keyCode===i);p&&r.value[p]&&M(r.value[p].url)};N(()=>{document.addEventListener("keydown",k)}),q(()=>{document.removeEventListener("keydown",k)});const n=z(!1),s=(a,i)=>{i&&r.value[i]?M(r.value[i].url):(n.value=!0,t.editingInfo.key=i,setTimeout(()=>{t.editingActive=!0},200))},l=()=>{t.editingInfo.key="",t.editingInfo.url="",t.editingInfo.remark="",t.editingActive=!1},V=(a,i)=>{n.value=!0,t.editingInfo.key=i;const{url:p,remark:f}=r.value[i];t.editingInfo.url=p,t.editingInfo.remark=f,setTimeout(()=>{t.editingActive=!0},200)},U=()=>{if(t.editingInfo.url&&t.editingInfo.remark&&confirm(v("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){t.editingInfo.url="",t.editingInfo.remark="";const a=G(r);delete a[t.editingInfo.key],I(a),l(),n.value=!1}},h=z(!1),L=async()=>{if(!(!t.editingInfo.url||!t.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(t.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(t.editingInfo.url)||(t.editingInfo.url="https://"+t.editingInfo.url),h.value=!0;let[a,i]=await P(te(B(t.editingInfo.url)));a&&(i=`${new URL(t.editingInfo.url).origin}/favicon.ico`);const p=JSON.parse(JSON.stringify(r.value));p[t.editingInfo.key]={url:t.editingInfo.url,remark:t.editingInfo.remark,icon:i},I(p),setTimeout(()=>{l(),h.value=!1,n.value=!1},400)}else window.alert(v("URL\u5730\u5740\u4E0D\u6B63\u786E"))},O=a=>{const i=a.currentTarget;i.style.visibility="hidden",i.nextElementSibling.style.visibility="inherit"},I=a=>{const i=JSON.parse(JSON.stringify(W(e.element)));e.isAction?(i.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=a,d.updateActionElement(i)):i.componentSetting.userSettingKeyMap=a,d.editComponent(i)},M=a=>{e.componentSetting.jumpType===2?window.location.href=a:window.open(a)};return{keyboardMap:S,userSettingKeyMap:r,handleKeyClick:s,handleDialogClose:l,showDialog:V,editState:t,clearEidtInfo:U,handleImgError:O,handleUserKeySave:L,saveLoading:h,dialogVisible:n,positionCSS:C,getTargetIconV2:B}}}),y=e=>(Y("data-v-db1d19c0"),e=e(),ee(),e),ie=["onClick"],ne={class:"keys"},de={class:"keys-name"},ae=["onClick"],se=y(()=>o("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"14",height:"14"},[o("path",{d:"M231.08266667 509.49688889c-0.11377778 51.76888889-41.87022222 93.52533333-93.75288889 93.41155556-51.65511111-0.11377778-93.63911111-42.09777778-93.52533333-93.86666667 0-51.54133333 42.21155555-93.52533333 93.98044444-93.41155556 51.65511111 0.11377778 93.29777778 41.984 93.29777778 93.86666667z m656.49777778-93.75288889c51.76888889 0 93.86666667 41.87022222 93.86666666 93.52533333 0.11377778 51.65511111-41.87022222 93.75288889-93.63911111 93.75288889-51.88266667 0-93.75288889-41.64266667-93.75288889-93.52533333s41.64266667-93.75288889 93.52533334-93.75288889zM512.45511111 603.02222222c-51.65511111 0-93.98044445-42.43911111-93.75288889-93.75288889 0.34133333-51.76888889 42.21155555-93.52533333 93.98044445-93.52533333 51.65511111 0 93.86666667 42.21155555 93.63911111 93.75288889-0.11377778 51.65511111-42.09777778 93.52533333-93.86666667 93.52533333z"})],-1)),re=[se],le={key:1,class:"plus-box"},pe=y(()=>o("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[o("path",{d:"M896 469.333333H554.666667V128a42.666667 42.666667 0 0 0-85.333334 0v341.333333H128a42.666667 42.666667 0 0 0 0 85.333334h341.333333v341.333333a42.666667 42.666667 0 0 0 85.333334 0V554.666667h341.333333a42.666667 42.666667 0 0 0 0-85.333334z"})],-1)),ce=[pe],ue={key:2,class:"icon-box"},ye=["src"],be={class:"no-icon",style:{visibility:"hidden"}},ge={key:3,class:"mark-text"},ke={class:"keys-wrapper",style:{width:"9.08%"}},fe=y(()=>o("div",{class:"keys"},null,-1)),me=[fe],ve={class:"editing-key"},he=y(()=>o("div",{class:"label"},"URL",-1)),we=y(()=>o("div",{class:"line"},null,-1)),xe=y(()=>o("div",{class:"label"},"Remark",-1)),Se=y(()=>o("div",{class:"line"},null,-1)),Ce={class:"footer",style:{"text-align":"right",padding:"12px"}},Ie=["disabled"],Me=["loading"];function Ke(e,d,r,C,v,t){const k=Q("easy-dialog");return c(),u("div",{class:"wrapper",style:g({...e.positionCSS})},[o("div",{class:"keyboard-mode",style:g({maxWidth:e.componentSetting.keyboardMaxWidth+"px"})},[(c(!0),u(J,null,Z(e.keyboardMap,(n,s)=>(c(),u("div",{class:w(["keys-wrapper",{hidden:n.span}]),key:s,style:g({width:`${n.span?n.span*4.5:9}%`,padding:`${e.componentSetting.keyGutter}px`})},[o("div",{class:"keys-box",onClick:l=>e.handleKeyClick(l,s),style:g({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},[o("div",ne,[o("div",de,b(s),1),e.userSettingKeyMap[s]?(c(),u("div",{key:0,class:"edit-icon-box",onClick:_(l=>e.showDialog(l,s),["stop"])},re,8,ae)):m("",!0),e.userSettingKeyMap[s]?m("",!0):(c(),u("div",le,ce)),e.userSettingKeyMap[s]?(c(),u("div",ue,[o("img",{class:"icon",src:e.userSettingKeyMap[s].icon||e.getTargetIconV2(e.userSettingKeyMap[s].url),alt:"link",onError:d[0]||(d[0]=(...l)=>e.handleImgError&&e.handleImgError(...l))},null,40,ye),o("div",be,b(e.userSettingKeyMap[s].remark.slice(0,1)),1)])):m("",!0),e.userSettingKeyMap[s]&&e.userSettingKeyMap[s].remark?(c(),u("div",ge,b(e.userSettingKeyMap[s].remark),1)):m("",!0)])],12,ie)],6))),128)),o("div",ke,[o("div",{class:"keys-box",style:g({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},me,4)])],4),F(k,{modelValue:e.dialogVisible,"onUpdate:modelValue":d[6]||(d[6]=n=>e.dialogVisible=n),width:"300px",height:"330px",closeOnClickOutside:"",onClose:e.handleDialogClose},{footer:E(()=>[o("div",Ce,[o("button",{type:"button",class:"btn",disabled:!e.editState.editingInfo.url&&!e.editState.editingInfo.remark,onClick:d[4]||(d[4]=(...n)=>e.clearEidtInfo&&e.clearEidtInfo(...n))},b(e.$t("\u6E05\u7A7A")),9,Ie),o("button",{type:"button",class:"btn btn-primary",loading:e.saveLoading,onClick:d[5]||(d[5]=(...n)=>e.handleUserKeySave&&e.handleUserKeySave(...n))},b(e.$t("\u786E\u8BA4")),9,Me)])]),default:E(()=>[x(o("div",{class:"edit-content",onKeydown:d[3]||(d[3]=_(()=>{},["stop"]))},[o("div",ve,b(e.editState.editingInfo.key),1),o("div",{class:w(["row-input",{active:e.editState.editingInfo.url.length>0}])},[x(o("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=n=>e.editState.editingInfo.url=n)},null,512),[[A,e.editState.editingInfo.url]]),he,we],2),o("div",{class:w(["row-input",{active:e.editState.editingInfo.remark.length>0}])},[x(o("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=n=>e.editState.editingInfo.remark=n)},null,512),[[A,e.editState.editingInfo.remark]]),xe,Se],2)],544),[[X,e.editState.editingActive]])]),_:1},8,["modelValue","onClose"])],4)}var _e=R(oe,[["render",Ke],["__scopeId","data-v-db1d19c0"]]);export{_e as default};
