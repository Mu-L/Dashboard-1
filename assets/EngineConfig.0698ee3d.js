var R=Object.defineProperty;var x=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var A=(e,n,p)=>n in e?R(e,n,{enumerable:!0,configurable:!0,writable:!0,value:p}):e[n]=p,V=(e,n)=>{for(var p in n||(n={}))J.call(n,p)&&A(e,p,n[p]);if(x)for(var p of x(n))O.call(n,p)&&A(e,p,n[p]);return e};import{D as X}from"./vuedraggable.umd.4caab6f4.js";import{g as U}from"./images.c918f91a.js";import{_ as Y,d as G,T as M,r as D,I as H,x as K,a as Q,G as W,o as l,j as u,g as a,t as s,h as r,b as d,i as g,F as L,a0 as Z,P as ee,s as N,a3 as te,f as v,U as T,l as ne,c as z,p as oe,q as ae}from"./index.ffc16ffa.js";const ie=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u6587\u5B57\u56FE\u6807",value:"text"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],le=G({name:"EngineConfig",components:{Draggable:X,Tips:M},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:n}){const p=D(!1),F=D(!1),m=D([]),w=D([]),k=D(""),h=D(!1),{t:b}=H();K(()=>{m.value=JSON.parse(JSON.stringify(e.engineList)),w.value=JSON.parse(JSON.stringify(e.backupEngineList))});const C=f=>{const{oldIndex:c}=f,{iconType:i}=m.value[c];i!=="local"&&(F.value=!0)},B=async()=>{await Z(),F.value=!1},_=f=>{const{originalEvent:c}=f;let i;if(c.type==="touchend"){const{clientX:y,clientY:E}=c.changedTouches[0];i=document.elementFromPoint(y,E)}else{const{clientX:y,clientY:E}=c;i=document.elementFromPoint(y,E)}if((i==null?void 0:i.className)==="delete-area"&&window.confirm(b("\u662F\u5426\u5220\u9664\u8BE5\u81EA\u5B9A\u4E49\u5F15\u64CE"))){const{newIndex:y}=f;m.value.splice(y,1)}n("update",{engineList:m.value,backupEngineList:w.value})},o=Q({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0",trigger:"blur"}],link:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",trigger:"blur"}],iconType:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u6807\u7C7B\u578B",trigger:"change"}],iconPath:[{validator:$,trigger:"blur"}]}});function $(f,c,i){o.formData.iconType==="network"&&!c?i(new Error("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")):i()}const t=D(),I=W(()=>o.formData.iconType==="api"&&o.formData.link||o.formData.iconType==="network"&&o.formData.iconPath||o.formData.iconType==="text"&&o.formData.name),j=()=>{o.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value=!0},P=()=>{t.value.resetFields(),o.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value=!1};return{engineDialogVisible:h,dragDisabled:p,showDeleteArea:F,cloneEngineList:m,cloneBackupEngineList:w,handleDragChoose:C,handleDragUnchoose:B,handleDragEnd:_,handleAddNewEngine:j,handleEditEngine:f=>{const{_id:c,name:i,link:y,iconType:E,iconPath:q}=f;E!=="local"&&(o.formData={_id:c,name:i,link:y,iconType:E,iconPath:q},h.value=!0)},iconTypeList:ie,state:o,form:t,showIconPreview:I,close:P,submit:()=>{t.value.validate(async f=>{if(f){if(o.formData.iconType==="api"&&k.value)try{const i=await(await fetch(`${ee}/api/icon?url=${encodeURIComponent(o.formData.link)}&type=link`)).text();i&&(o.formData.iconType="network",o.formData.iconPath=i)}catch{}if(o.formData._id){const c=m.value.findIndex(i=>i._id===o.formData._id);~c&&(m.value[c]=V({},N(o.formData)))}else o.formData._id=te(),m.value.push(V({},N(o.formData)));n("update",{engineList:m.value,backupEngineList:w.value}),P()}else return!1})},getTargetIcon:U,tempIconLink:k,handleLinkInputBlur:()=>{k.value=U(o.formData.link)}}}}),S=e=>(oe("data-v-20649a42"),e=e(),ae(),e),se={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},ue={class:"warning"},re={class:"content"},de={class:"text s-title"},pe={class:"current-engine-wrapper"},ce=["onDblclick","title"],ge=["src"],me=["src"],fe={key:2,class:"no-icon"},he={class:"text"},ve={class:"text s-title"},be={class:"backup-engine-wrapper"},ye={class:"engine-list-item"},De=["src"],ke=["src"],Ee={key:2,class:"no-icon"},we={class:"text"},Fe={key:0,class:"delete-area"},_e={class:"form-control"},Te={class:"tips"},Ce=S(()=>a("b",null,"[0]",-1)),Be={class:"tips"},$e=S(()=>a("b",null,"https://juejin.im/search?query=[0]&type=all",-1)),Ve={class:"icon-img-preview-box"},Le=["src"],Ie=["src"],Pe={key:2,class:"no-icon"},xe={key:1,class:"icon-img-preview"},Ae={class:"footer",style:{"text-align":"right",padding:"12px"}};function Ue(e,n,p,F,m,w){const k=v("Draggable"),h=v("el-input"),b=v("el-form-item"),C=v("Tips"),B=v("el-radio"),_=v("el-radio-group"),o=v("el-form"),$=v("easy-dialog");return l(),u(L,null,[a("div",se,[a("div",ue,s(e.$t("searchConfigTips")),1),a("div",re,[a("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:n[0]||(n[0]=(...t)=>e.handleAddNewEngine&&e.handleAddNewEngine(...t))},s(e.$t("\u6DFB\u52A0")),1),a("div",de,s(e.$t("\u5F53\u524D\u5F15\u64CE\u7EC4")),1),a("div",pe,[r(k,{modelValue:e.cloneEngineList,"onUpdate:modelValue":n[1]||(n[1]=t=>e.cloneEngineList=t),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:d(({element:t})=>[a("div",{class:"engine-list-item",onDblclick:I=>e.handleEditEngine(t),title:t.iconType!=="local"?e.$t("\u53CC\u51FB\u91CD\u65B0\u7F16\u8F91"):""},[t.iconType==="local"||t.iconType==="network"?(l(),u("img",{key:0,src:t.iconPath,alt:"icon",width:"24",height:"24"},null,8,ge)):g("",!0),t.iconType==="api"?(l(),u("img",{key:1,src:e.getTargetIcon(t.link),alt:"icon",width:"24",height:"24"},null,8,me)):g("",!0),t.iconType==="text"?(l(),u("div",fe,s(t.name.slice(0,1)),1)):g("",!0),a("div",he,s(t.name),1)],40,ce)]),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),a("div",ve,s(e.$t("\u5907\u7528\u5F15\u64CE\u7EC4")),1),a("div",be,[r(k,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":n[2]||(n[2]=t=>e.cloneBackupEngineList=t),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:d(({element:t})=>[a("div",ye,[t.iconType==="local"||t.iconType==="network"?(l(),u("img",{key:0,src:t.iconPath,alt:"icon",width:"24",height:"24"},null,8,De)):g("",!0),t.iconType==="api"?(l(),u("img",{key:1,src:e.getTargetIcon(t.link),alt:"icon",width:"24",height:"24"},null,8,ke)):g("",!0),t.iconType==="text"?(l(),u("div",Ee,s(t.name.slice(0,1)),1)):g("",!0),a("div",we,s(t.name),1)])]),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(l(),u("div",Fe,s(e.$t("\u62D6\u62FD\u81F3\u6B64\u5904\u5220\u9664")),1)):g("",!0)])])]),r($,{modelValue:e.engineDialogVisible,"onUpdate:modelValue":n[10]||(n[10]=t=>e.engineDialogVisible=t),title:`${e.state.formData._id?e.$t("\u7F16\u8F91"):e.$t("\u6DFB\u52A0")}${e.$t("\u81EA\u5B9A\u4E49\u5F15\u64CE")}`,width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog"},{footer:d(()=>[a("div",Ae,[a("button",{type:"button",class:"btn",onClick:n[8]||(n[8]=(...t)=>e.close&&e.close(...t))},s(e.$t("\u53D6\u6D88")),1),a("button",{type:"button",class:"btn btn-primary",onClick:n[9]||(n[9]=(...t)=>e.submit&&e.submit(...t))},s(e.$t("\u786E\u8BA4")),1)])]),default:d(()=>[r(o,{ref:"form","label-width":"90px",model:e.state.formData,rules:e.state.formRules},{default:d(()=>[r(b,{label:e.$t("\u5F15\u64CE\u540D\u79F0"),prop:"name"},{default:d(()=>[r(h,{modelValue:e.state.formData.name,"onUpdate:modelValue":n[3]||(n[3]=t=>e.state.formData.name=t),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(b,{label:e.$t("\u5F15\u64CE\u5730\u5740"),prop:"link"},{default:d(()=>[a("div",_e,[r(h,{modelValue:e.state.formData.link,"onUpdate:modelValue":n[4]||(n[4]=t=>e.state.formData.link=t),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740"),onBlur:e.handleLinkInputBlur},null,8,["modelValue","placeholder","onBlur"]),r(C,null,{default:d(()=>[a("div",Te,[T(s(e.$t("engineConfigTips1"))+" ",1),Ce,T(" "+s(e.$t("engineConfigTips2")),1)]),a("div",Be,[T(s(e.$t("\u4F8B\u5982"))+": ",1),$e])]),_:1})])]),_:1},8,["label"]),r(b,{label:e.$t("\u5F15\u64CE\u56FE\u6807"),prop:"iconType"},{default:d(()=>[r(_,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[5]||(n[5]=t=>e.state.formData.iconType=t)},{default:d(()=>[(l(!0),u(L,null,ne(e.iconTypeList,t=>(l(),z(B,{label:t.value,key:t.value},{default:d(()=>[T(s(e.$t(t.label)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.state.formData.iconType==="network"?(l(),z(b,{key:0,label:e.$t("\u56FE\u6807\u5730\u5740"),prop:"iconPath"},{default:d(()=>[r(_,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[7]||(n[7]=t=>e.state.formData.iconType=t)},{default:d(()=>[r(h,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":n[6]||(n[6]=t=>e.state.formData.iconPath=t),placeholder:e.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):g("",!0),r(b,{label:e.$t("\u56FE\u6807\u9884\u89C8")},{default:d(()=>[a("div",Ve,[e.showIconPreview?(l(),u(L,{key:0},[e.state.formData.iconType==="network"?(l(),u("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,Le)):g("",!0),e.state.formData.iconType==="api"?(l(),u("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,Ie)):g("",!0),e.state.formData.iconType==="text"?(l(),u("div",Pe,s(e.state.formData.name.slice(0,1)),1)):g("",!0)],64)):(l(),u("div",xe))])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}var Oe=Y(le,[["render",Ue],["__scopeId","data-v-20649a42"]]);export{Oe as default};
